计算机与操作系统概论/介绍
  计算机硬件系统
    存储程序计算机（冯诺依曼体系）
    总线
      内部总线（CPU内部）、系统总线（连接CPU、存储器、外设）、通信总线（计算机系统之间通信、网络）
    CPU
      ALU、Register、CTL
    存储器（层次）
      寄存器->L1/L2/L3 cache->SSD->Disk->Web、分布式文件系统
    外设
      分类：输入、输出、存储、通信；字节、字符、块
      控制方式：轮询、中断（CPU控制读写数据）、DMA（DMA控制读写数据）

  计算机软件系统
    系统软件（OS，实用程序，语言处理程序，DBMS）
    支撑软件（开发工具）
    应用软件
    
    计算机硬件系统		机器语言
    操作系统（硬件资源管理）	机器语言+广义指令
    操作系统之文件系统	机器语言+系统调用
    数据库管理系统		数据库语言
    语言处理系统		高级语言
    支撑软件		。。。

  计算机操作技术的发展
    1 原始开关/控制台
    2 装入程序，将机器语言程序装入内存（卡带/纸带）
    3 引入汇编语言，符号化机器语言
    4 批处理。引入作业控制语言，用户可编写作业说明书，成批输入作业
    5 多道程序同时运行，实现程序的切换

  计算机操作系统
    操作系统的组成：
      进程调度、进程通信、内存管理、设备管理、文件管理、网络通信、作业控制
    几类操作系统：
      多道批处理（脱机控制方式）、分时（交互控制方式）、实时
    资源管理的角度：
      资源：处理器、内存、设备、信息资源管理（文件等）、信号量资源（进程间通信）
      屏蔽资源底层的使用细节：使用驱动程序，屏蔽底层细节，向其他部分提供一个抽象的、通用的接口
      资源的共享与分配：
        资源共享方式：独占、并发
        资源分配策略：静态、动态、抢占
    控制程序执行的角度：
      多道程序设计，并发使用CPU
      实现：进程
        如何使用资源：调用操作系统提供的服务例程（陷入操作系统）
        如何复用CPU：进程调度
        如何使CPU与I/O设备充分并行：设备控制器与“通道（专门的I/O处理器）”
        如何让正在运行的程序让出CPU：中断
    控制计算机的角度：
      OS提供：操作接口（系统/命令程序）、作业级接口
    人机交互的角度：
      热点！！！
    程序接口的角度：
      程序接口：系统调用——访问操作系统的接口，完成某种特定功能的过程
      系统调用的实现：
        机制：陷入处理机制；陷入指令（引起处理器终端的制定）；对系统调用编号，约定好存放参数的寄存器
        要点：编写系统调用处理程序、系统调用入口地址表、开辟现场保护区（以保存发生系统调用时的处理器现场）
    系统结构的角度：
      模块化、层次化、虚拟化
      OS构件：内核、进程、现成、管程
      单内核、微内核、混合内核、外内核

处理器管理
  处理器与寄存器
    处理器及其部件：
      ALU、IR、ID、PC、标志寄存器flag、内存地址寄存器MAR、内存数据寄存器MDR、IO地址寄存器、IO数据寄存器；
      使用“地址、数据、控制信号”与内存或其他资源交互
    用户程序可见寄存器：
      数据寄存器：AX、BX、CX、DX（通用寄存器）
      地址寄存器：SI、DI（通用寄存器，索引）；SP、BP（通用寄存器，栈指针）；段地址（通用寄存器，CS、DS、SS、ES）
      控制与状态寄存器：PC、IR（指令寄存器）、条件码CC、flag（中断相关的位、处理器模式位、内存保护位）
    程序状态字（PSW）：
      操作系统概念：指记录当前程序运行的动态信息，通常包含（PC、IR、CC、flag）
      计算机系统的寄存器：通常设置一组控制与状态寄存器或专门的PSW寄存器
  指令与处理器模式
    指令：流水线、特权与非特权指令
    处理器模式位：实现特权指令管理
      一般情况：0操作系统内核、1系统调用、2共享库程序、3用户程序（一般只用0和3）
    模式切换：用户和内核态切换
      只有中断、异常、系统异常（请求os服务）可以由用户态切换到内核态
      中断返回指令：返回至用户模式
    中断：
      操作系统是“中断驱动”的（广义的中断）
      狭义的中断：I/O中断、时钟中断、外部信号中断
      广义的中断：
        异常：地址异常、算术异常
        系统异常：执行陷入指令而触发系统调用引起的中断事件
    中断源：
      外中断：即由外部设备、接口卡引起的中断
      内中断：即程序运行错误引起的中断
      软件中断：由写在程序中的语句引起的中断程序的执行，称为软件中断
    中断系统：
      包括硬件子系统（响应）和软件子系统（处理）
      中断响应处理：
        在指令执行周期中加入一个检查中断阶段（在取指、解码、执行后）
        外中断：中断控制器（中断控制逻辑线路和中断寄存器）
        内中断：CPU内部线路发现，陷阱
        系统异常：陷入指令触发，系统陷阱
      中断响应过程：
        发现中断源：中断寄存器中的请求——是否屏蔽——响应最优先的
        中断当前程序：保存当前的PSW/PC到进程的核心栈（保护硬件现场）
        转向os中断处理程序
      中断处理程序：
        （开始前，置PSW为操作系统内核的PSW，启动操作系统内核中断处理程序，实现硬件到软件的切换）
        保护未被硬件保护的CPU现场（cache？其它寄存器）
        分析被中断进程的PSW，识别中断源
        处理中断
        软件恢复现场（原进程或其他进程）
        硬件恢复PSW
    多中断的响应与处理
      中断屏蔽：中断屏蔽位，有选择的响应
      中断优先级：有优先度的响应（各类中断：CPU硬件故障中断、自愿性中断、程序性中断、时钟中断等外部中断、I/O中断、重启/关机中断）
      中断的嵌套处理：一般3层内，响应与处理顺序可以不一样了，改变了中断处理顺序
      多中断的响应与处理
    进程及其概念
      进程：一个具有一定独立功能的程序关于某个数据集合的一次运行活动
      进程时os进行资源分配和调度的一个独立单位
      进程包括：
        数据结构P（进程控制块PCB之类的，os管理运行程序的）
        内存代码C
        内存数据D
        通用寄存器信息R
        程序状态字信息PSW
      进程状态：运行态、等待态、就绪态、挂起等待态、挂起就绪态
      进程挂起：挂起时没有任何资源！该进程被调入OS管理的对换区，不参与进程调度；待适当时重新调入内存
    进程的数据描述
      进程控制块（PCB）：os用于记录和刻画进程状态及环境信息的数据结构
        标识信息：进程标识
        现场信息：用户可见寄存器内容、控制/状态寄存器内容、用户/核心栈指针
        控制信息：进程调度相关信息（状态、等待事件、优先级）、进程程序/数据地址、进程队列指引元（进程队列指针、父子兄弟进程指针）、进程通信相关信息（消息对列、信号量、锁）、进程处理器使用信息（占用的CPU、时间片、已执行总时间、记账信息）、进程特权信息（内存访问权限、处理器权限）、进程资源清单（占有、使用的资源）
      进程的内存映像（Process Image）：
        进程控制块、进程程序块、进程数据块、核心栈（进程在内核模式下运行时使用的堆栈，中断或系统过程使用）、共享地址空间
      进程上下文（Process）
        用户级上下文：用户程序块/用户数据区/用户栈/用户共享内存
        寄存器上下文：PSW/栈指针/通用寄存器
        系统级上下文：PCB/内存区表/核心栈
    进程的管理
      概念级的OS进程管理软件：系统调用/中断/异常处理、队列管理、进程控制、进程调度、进程通信、终端登录/作业控制、性能监控、审计
      队列模型：
        就绪队列、等待事件1/2/3队列
        FIFO或优先级队列
      进程控制与管理：
        创建、撤销、阻塞、唤醒、挂起、激活、其他
      进程控制原语
        进程控制过程中涉及对OS核心数据结构的修改
    进程切换与模式切换
      模式切换：
        用户->内核——中断/异常/系统调用，基本任务：
          处理器模式转为内核模式
          保存当前进程的PC/PSW到当前进程的核心栈
          转向中断/异常/系统调用处理程序
        内核->用户——中断返回指令，基本任务：
          从待运行进程核心栈中弹出PSW/PC值
          处理器模式转为用户模式
      进程切换：收回、分配处理器；实质上是被中断运行进程与待运行进程的上下文切换
        工作过程：
          正向模式切换（压入PSW/PC）
          保存被中断进程的现场
          处理具体中断/异常
          把被中断进程的SP保存到PCB
          调整被中断进程的PCB
          把被中断进程的PCB加入相关队列
          ==========选择下一个占用CPU的进程==========
          修改新进程的PCB
          设置被选中进程的地址空间，回复存储管理信息
          恢复SP至寄存器中
          恢复现场
          逆向模式转换（弹出PSW/PC）
    多线程
      多线程环境下，进程是操作系统进行《保护》和《资源分配》的独立单位
        资源分配：容纳进程映像的虚拟地址空间
        保护：对进程、文件和设备的存取保护机制
      线程是调度的基本单位
        线程具有独立的：线程执行状态、受保护的线程上下文、PC、执行堆栈、容纳局部变量的静态存储器
        线程共享进程获得的主存空间和资源
    KLT和ULT
      内核级多线程KLT
        OS内核直接调度KLT，管理线程
        OS提供API供开发者使用KLT
        多处理器环境中，内核能同时调度统一进程的多个线程并行执行
        线程调度需要进行模式切换，在内核模式完成
      用户级多线程ULT（想想python的多“线程”）
        用语言带的线程库，在用户空间运行
        内核没意识到线程的存在，逻辑上并发
        节省模式切换开销
        用户自定义调度算法
        可移植性高
        不能利用多处理器的优点，OS只能调度进程而非每个ULT（一个ULT代表一个进程），物理上并行性差
      Jacketing程序将内核调度转化为用户调度
    多线程的实现的混合式策略
      ULT与KLT多对多绑定
      KLT状态：可运行态、运行态、阻塞态
      ULT状态：可运行态、活跃态（对应KLT的状态）、睡眠态
    处理器调度的层次
      高级调度（长程调度）:决定能否加入到执行的进程池中
      中级调度（平衡负载调度）:决定哪个可用进程占用CPU（挂起？）
      低级调度（短程调度）:决定主存中的可用进程集合（新建后挂起？）
      高级调度介绍：
        分时OS中，高级调度决定：是否接受一个终端用户的连接、命令是否被接纳形成进程、新建态进程是否加入就绪队列？
        批处理：选取《后备》作业加入主存？为作业做准备、善后
    处理器调度算法
      原则：
        资源利用率（CPU和其他资源）
        响应时间
        周转时间（提交给系统开始到执行完的时间）
        吞吐量（单位时间处理的进程数量）
        公平性
      算法：
        优先数调度算法
        时间片轮转调度算法
        分级调度算法
          多个不同优先级队列，不同优先级的时间片长短不同
        彩票调度算法
          为进程发放针对系统各种资源（如CPU时间）的彩票，当需要做出决策时，随机选择一张彩票，看谁中奖
          合作进程之间的彩票交换

存储管理









设备管理
       I/O设备分类：输入/出；人机交互/存储/机机通信；字符/块/网络
       设备管理目标：
              解决设备和CPU速度的不匹配，充分并行
              屏蔽设备的物理细节和操作过程，配置驱动程序，提供统一界面
                    裸设备
                    设备文件
       设备管理的功能：
              设备中断处理
              缓冲区管理
              设备的分配和去配
              设备驱动调度
              虚拟设备的实现
       设备管理的实现层次：
              I/O硬件：I/O设备及其接口线路、控制部件、通道
              I/O软件：系统I/O软件、用户空间I/O软件

I/O控制方式
       系统交互的对象：设备控制器（设备适配器、I/O控制器、。。。）
       设备控制器集成在主板上，不在设备里！
       设备控制器的功能：
              接受和识别CPU或通道发来的命令
              实现数据交换
              发现和记录设备及自身的状态信息，供CPU处理时使用
              当连接多台设备时，识别设备地址
       轮询方式：
              处理器轮询时不能做其他事情
       中断方式：
              流程：CPU向I/O控制器发送I/O命令，控制器去I/O；控制器I/O完后中断CPU；CPU进入中断处理程序，执行内存数据交换
       DMA（直接存储器访问）方式：
              流程：CPU向控制器DMA模块发出I/O命令；CPU不做内存数据交换，由DMA一并完成；DMA传送完数据后再中断CPU；CPU中断，读DMA状态
              DMA和CPU要竞争内存总线，但影响不大（流水线CPU执行时总有不要交换数据的时候）
       通道方式：
              前三种方式物理并行，CPU与通道高速并行
              I/O通道（通道控制器、I/O处理器）：是一个简单的处理器，用于完成逻辑上独立的I/O任务
              四级连接：处理器、通道、控制器、设备
              通道可控制多台同类或不同类的设备
              流程：
                     CPU遇到I/O任务，组织通道程序，置通道程序地址字CAW，启动指定通道；CPU执行其他任务
                     通道从CAW获得通道程序，控制I/O设备进行操作
                     I/O通道完成I/O操作后发出中断；CPU处理中断，从通道程序状态字CSW获得通道执行情况，处理I/O操作

总线与I/O：
       总线解决I/O速度不匹配问题
       单总线结构模型：一条总线，连接CPU、主存与所有I/O设备
       三级总线模型：CPU内部总线（与cache）、CPU-主存总线、外设扩展总线
       南北桥模型：CPU内部总线、主存总线、PCI总线（北桥、高速外设）、E（ISA）总线（南桥、慢速外设）
       基于通道的服务器总线模型：有层级，有通道管控制器

I/O软件：
       设计目标：高效率、通用性
       设计思路：软件组织成层次；低层屏蔽硬件细节、高层提供友善界面
       问题：设备无关性、出错处理（低层错误不给高层）、同步/异步传输、缓冲技术
       层次结构：
              用户空间的软件（系统调用、格式化）
              独立于设备的软件（逻辑功能：设备的命名、保护、阻塞 、缓冲、分配、跟踪）
              设备驱动程序（设备初始化、启动I/O操作、检查I/O状态，对应某类设备的具体细节，可以分层设计）
              中断处理程序（处理中断、报告错误、中断时唤醒驱动程序，响应/原则处理）
              硬件

I/O缓冲区：
       在内存中开辟的存储区，专门用于临时存放I/O操作的数据
       why：
             CPU与设备速度不匹配
             逻辑/物理记录大小不一致
             并行性
             减少中断
             放宽CPU对中断响应时间的要求

设备独立性：
       用户不指定物理设备，而是指定逻辑设备，使用户进程和物理设备分离开来
       通过其它途径建立逻辑设备和物理设备之间的映射
       系统需提供逻辑设备名和物理设备名的对应表
       易于应对各种I/O设备故障，提高系统可靠性、设备分配的灵活性








